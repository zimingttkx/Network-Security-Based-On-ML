# 项目架构

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                         前端层                                │
│   Bootstrap 5 + JavaScript + 多语言支持 (i18n)               │
└─────────────────┬───────────────────────────────────────────┘
                  │
┌─────────────────┴───────────────────────────────────────────┐
│                      应用层 (FastAPI)                         │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │威胁预测  │  │模型训练  │  │数据验证  │  │  API网关 │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────┬───────────────────────────────────────────┘
                  │
┌─────────────────┴───────────────────────────────────────────┐
│                      业务逻辑层                               │
│  ┌──────────────────────────────────────────────────────┐  │
│  │           训练管道 (Training Pipeline)                 │  │
│  │  数据摄取 → 数据验证 → 数据转换 → 模型训练 → 模型评估  │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────┬───────────────────────────────────────────┘
                  │
┌─────────────────┴───────────────────────────────────────────┐
│                      数据层                                   │
│  ┌───────────┐  ┌──────────┐  ┌───────────┐               │
│  │  CSV文件  │  │  模型文件 │  │  日志文件  │               │
│  └───────────┘  └──────────┘  └───────────┘               │
└───────────────────────────────────────────────────────────────┘
```

## 核心组件

### 1. 数据摄取 (Data Ingestion)
- **位置**: `networksecurity/components/data_ingestion.py`
- **功能**: 从CSV文件或MongoDB读取数据
- **输出**: 训练集和测试集

### 2. 数据验证 (Data Validation)
- **位置**: `networksecurity/components/data_validation.py`
- **功能**: 验证数据质量和完整性
- **输出**: 验证报告和清洗后的数据

### 3. 数据转换 (Data Transformation)
- **位置**: `networksecurity/components/data_transformation.py`
- **功能**: 特征工程和数据预处理
- **输出**: 转换后的训练数据和预处理器

### 4. 模型训练 (Model Trainer)
- **位置**: `networksecurity/components/model_trainer.py`
- **功能**: 训练多个模型并选择最佳模型
- **支持算法**:
  - RandomForest
  - GradientBoosting
  - AdaBoost
  - LogisticRegression
  - SVC
  - KNeighbors
  - GaussianNB
  - XGBoost

### 5. 训练管道 (Training Pipeline)
- **位置**: `networksecurity/pipeline/training_pipeline.py`
- **功能**: 协调整个训练流程
- **流程**: 数据摄取 → 验证 → 转换 → 训练 → 评估

## 技术栈

### 后端
- **FastAPI**: Web框架
- **Uvicorn**: ASGI服务器
- **Scikit-learn**: 机器学习库
- **XGBoost**: 梯度提升算法
- **Pandas**: 数据处理
- **NumPy**: 数值计算

### 前端
- **Bootstrap 5**: UI框架
- **JavaScript**: 交互逻辑
- **WebSocket**: 实时通信

### 数据存储
- **CSV**: 本地数据文件
- **PKL**: 模型序列化
- **MongoDB**: 可选的数据库支持

## 设计模式

### 1. 管道模式 (Pipeline Pattern)
训练流程采用管道模式，每个组件独立且可复用。

### 2. 配置驱动 (Configuration-Driven)
使用YAML配置文件管理参数，便于调整。

### 3. 异常处理
统一的异常处理机制，便于调试和维护。

## 数据流

```
CSV文件 → 数据摄取 → 数据验证 → 数据转换 → 模型训练 → 模型文件
                                                    ↓
                                              模型评估
                                                    ↓
                                              性能指标
```

## 目录结构

```
Network-Security-Based-On-ML/
├── networksecurity/          # 核心代码
│   ├── components/          # 训练组件
│   ├── pipeline/            # 训练管道
│   ├── config/              # 配置管理
│   ├── logging/             # 日志系统
│   ├── exception/           # 异常处理
│   └── utils/               # 工具函数
├── Templates/               # HTML模板
├── static/                  # 静态资源
├── Network_Data/            # 训练数据
├── final_models/            # 最终模型
├── Artifacts/               # 训练产物
├── logs/                    # 日志文件
└── test_app.py             # 应用入口
```

## 扩展性

### 添加新算法
在 `model_trainer.py` 的 `models` 字典中添加新模型。

### 添加新特征
修改数据转换组件，添加特征工程逻辑。

### 添加新API
在 `test_app.py` 中添加新的路由。

## 性能优化

- 使用KNN Imputer进行缺失值填充
- GridSearchCV进行超参数优化
- 多进程并行训练（n_jobs=-1）
- 模型缓存机制

## 安全考虑

- 输入验证
- 异常捕获
- 日志记录
- 环境变量管理
