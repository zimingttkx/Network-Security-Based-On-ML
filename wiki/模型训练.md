# 模型训练教程

## 训练流程

模型训练包括以下步骤：

1. 数据摄取
2. 数据验证
3. 数据转换
4. 模型训练
5. 模型评估

## 使用默认数据训练

### 步骤1：访问训练页面

打开浏览器访问 http://localhost:8000/train

### 步骤2：选择数据源

选择"使用项目默认数据"选项。

### 步骤3：开始训练

点击"开始训练"按钮。

### 步骤4：观察训练进度

页面会实时显示训练日志，包括：
- 数据摄取进度
- 数据验证结果
- 模型训练进度
- 性能指标

### 步骤5：查看结果

训练完成后，页面会显示：
- 最佳模型名称
- 训练集性能指标
- 测试集性能指标

## 使用自定义数据训练

### 数据准备

准备CSV格式的数据文件，必须包含以下30个特征：

1. having_IP_Address
2. URL_Length
3. Shortining_Service
4. having_At_Symbol
5. double_slash_redirecting
6. Prefix_Suffix
7. having_Sub_Domain
8. SSLfinal_State
9. Domain_registeration_length
10. Favicon
11. port
12. HTTPS_token
13. Request_URL
14. URL_of_Anchor
15. Links_in_tags
16. SFH
17. Submitting_to_email
18. Abnormal_URL
19. Redirect
20. on_mouseover
21. RightClick
22. popUpWidnow
23. Iframe
24. age_of_domain
25. DNSRecord
26. web_traffic
27. Page_Rank
28. Google_Index
29. Links_pointing_to_page
30. Statistical_report

### 数据格式示例

```csv
having_IP_Address,URL_Length,Shortining_Service,...,Result
1,1,1,...,0
-1,-1,-1,...,1
```

### 训练步骤

1. 访问训练页面
2. 选择"上传自定义数据"
3. 点击"查看特征要求"了解所需特征
4. 上传CSV文件
5. 点击"验证数据"
6. 如有缺失特征，选择补全策略
7. 使用补全后的数据训练

## 数据补全策略

### mean（均值）
- 适用场景：缺失率 < 5%
- 说明：使用特征的平均值填充
- 优点：简单快速
- 缺点：可能引入偏差

### median（中位数）
- 适用场景：存在异常值
- 说明：使用特征的中位数填充
- 优点：对异常值鲁棒
- 缺点：可能不适合偏态分布

### most_frequent（最频繁值）
- 适用场景：类别特征
- 说明：使用出现最多的值填充
- 优点：保持数据分布
- 缺点：可能过度集中

### constant（常数）
- 适用场景：缺失率 > 15%
- 说明：使用固定值填充（如0）
- 优点：不引入额外信息
- 缺点：可能影响模型性能

### knn（K近邻）
- 适用场景：缺失率 5-15%
- 说明：基于相似样本填充
- 优点：效果最好
- 缺点：计算较慢

## 训练参数

### 模型列表

系统会训练以下8个模型：

1. **RandomForest** - 随机森林
2. **GradientBoosting** - 梯度提升
3. **AdaBoost** - 自适应提升
4. **LogisticRegression** - 逻辑回归
5. **SVC** - 支持向量机
6. **KNeighbors** - K近邻
7. **GaussianNB** - 朴素贝叶斯
8. **XGBoost** - 极端梯度提升

### 超参数搜索

每个模型使用GridSearchCV进行超参数优化：
- 交叉验证折数：3
- 并行任务数：-1（使用所有CPU核心）

## 训练时间

- 默认数据（11,055条）：5-10分钟
- 自定义数据：取决于数据量和电脑性能

## 训练输出

### 模型文件
- `final_models/model.pkl` - 最佳模型
- `final_models/preprocessor.pkl` - 数据预处理器

### 训练产物
- `Artifacts/` - 训练过程中的中间文件
- `logs/` - 训练日志

### 性能指标
- F1分数
- 精确率
- 召回率

## 通过API训练

```python
import requests

# 触发训练
response = requests.post('http://localhost:8000/api/train')
print(response.json())

# 输出: {"status": "success", "message": "模型训练任务已在后台启动"}
```

## 训练失败排查

### 常见问题

1. **数据格式错误**
   - 检查CSV文件格式
   - 确认列名正确

2. **缺失特征**
   - 使用数据验证功能检查
   - 使用数据补全功能

3. **内存不足**
   - 减少数据量
   - 关闭其他程序

4. **训练超时**
   - 检查数据质量
   - 减少超参数搜索空间

### 查看日志

训练日志保存在 `logs/` 目录：

```bash
tail -f logs/networksecurity_*.log
```

## 最佳实践

1. **数据质量**
   - 确保数据完整性
   - 检查异常值
   - 平衡正负样本

2. **特征工程**
   - 使用合适的补全策略
   - 标准化数值特征

3. **模型选择**
   - 观察各模型性能
   - 选择泛化能力好的模型

4. **定期重训练**
   - 使用新数据更新模型
   - 监控模型性能

## 下一步

- [威胁预测使用指南](威胁预测)
- [API使用文档](API文档)
