# 威胁预测使用指南

## 功能介绍

威胁预测功能可以根据网络流量的30个特征，判断该流量是否存在安全威胁。

## 使用Web界面

### 步骤1：访问预测页面

打开浏览器访问 http://localhost:8000/predict

### 步骤2：输入特征值

有两种方式输入特征：

#### 方式1：手动输入
在表单中逐个输入30个特征的值。

#### 方式2：使用示例数据
点击"填充示例数据"按钮，自动填充一组示例数据。

### 步骤3：提交预测

点击"预测"按钮，系统会返回预测结果。

### 步骤4：查看结果

预测结果包括：
- **预测类别**: 安全 或 威胁
- **置信度**: 模型的预测置信度

## 使用API

### Python示例

```python
import requests

# API端点
url = "http://localhost:8000/predict_live"

# 准备数据（30个特征）
data = {
    "having_IP_Address": 1,
    "URL_Length": 1,
    "Shortining_Service": 1,
    "having_At_Symbol": 1,
    "double_slash_redirecting": 1,
    "Prefix_Suffix": -1,
    "having_Sub_Domain": 1,
    "SSLfinal_State": 1,
    "Domain_registeration_length": 1,
    "Favicon": 1,
    "port": 1,
    "HTTPS_token": 1,
    "Request_URL": 1,
    "URL_of_Anchor": 1,
    "Links_in_tags": 1,
    "SFH": 1,
    "Submitting_to_email": 1,
    "Abnormal_URL": 1,
    "Redirect": 0,
    "on_mouseover": 1,
    "RightClick": 1,
    "popUpWidnow": 1,
    "Iframe": 1,
    "age_of_domain": 1,
    "DNSRecord": 1,
    "web_traffic": 1,
    "Page_Rank": 1,
    "Google_Index": 1,
    "Links_pointing_to_page": 1,
    "Statistical_report": 1
}

# 发送请求
response = requests.post(url, json=data)

# 解析结果
if response.status_code == 200:
    result = response.json()
    print(f"预测结果: {result['prediction']}")
    print(f"原始预测值: {result['raw_prediction']}")
else:
    print(f"请求失败: {response.status_code}")
```

### cURL示例

```bash
curl -X POST "http://localhost:8000/predict_live" \
  -H "Content-Type: application/json" \
  -d '{
    "having_IP_Address": 1,
    "URL_Length": 1,
    "Shortining_Service": 1,
    "having_At_Symbol": 1,
    "double_slash_redirecting": 1,
    "Prefix_Suffix": -1,
    "having_Sub_Domain": 1,
    "SSLfinal_State": 1,
    "Domain_registeration_length": 1,
    "Favicon": 1,
    "port": 1,
    "HTTPS_token": 1,
    "Request_URL": 1,
    "URL_of_Anchor": 1,
    "Links_in_tags": 1,
    "SFH": 1,
    "Submitting_to_email": 1,
    "Abnormal_URL": 1,
    "Redirect": 0,
    "on_mouseover": 1,
    "RightClick": 1,
    "popUpWidnow": 1,
    "Iframe": 1,
    "age_of_domain": 1,
    "DNSRecord": 1,
    "web_traffic": 1,
    "Page_Rank": 1,
    "Google_Index": 1,
    "Links_pointing_to_page": 1,
    "Statistical_report": 1
  }'
```

## 特征说明

### 特征值范围

大多数特征的值为：
- `-1`: 表示某种负面特征
- `0`: 表示中性或不确定
- `1`: 表示某种正面特征

### 特征列表

1. **having_IP_Address**: URL中是否包含IP地址
2. **URL_Length**: URL长度
3. **Shortining_Service**: 是否使用短链服务
4. **having_At_Symbol**: URL中是否包含@符号
5. **double_slash_redirecting**: 是否有双斜杠重定向
6. **Prefix_Suffix**: 前缀后缀
7. **having_Sub_Domain**: 是否有子域名
8. **SSLfinal_State**: SSL状态
9. **Domain_registeration_length**: 域名注册时长
10. **Favicon**: 网站图标
11. **port**: 端口
12. **HTTPS_token**: HTTPS令牌
13. **Request_URL**: 请求URL
14. **URL_of_Anchor**: 锚点URL
15. **Links_in_tags**: 标签中的链接
16. **SFH**: 服务器表单处理
17. **Submitting_to_email**: 提交到邮箱
18. **Abnormal_URL**: 异常URL
19. **Redirect**: 重定向
20. **on_mouseover**: 鼠标悬停事件
21. **RightClick**: 右键点击
22. **popUpWidnow**: 弹窗
23. **Iframe**: 内嵌框架
24. **age_of_domain**: 域名年龄
25. **DNSRecord**: DNS记录
26. **web_traffic**: 网络流量
27. **Page_Rank**: 页面排名
28. **Google_Index**: 谷歌索引
29. **Links_pointing_to_page**: 指向页面的链接
30. **Statistical_report**: 统计报告

## 预测结果解读

### 安全 (0)
表示该网络流量被判定为安全，不存在明显的威胁特征。

### 威胁 (1)
表示该网络流量被判定为存在威胁，可能是钓鱼网站或恶意链接。

## 注意事项

1. **必须提供所有30个特征**，缺少任何一个都会导致预测失败
2. **特征值必须为数值类型**，不能是字符串
3. **确保已训练模型**，否则预测会失败
4. **预测结果仅供参考**，不应作为唯一的安全判断依据

## 批量预测

如需批量预测，可以编写脚本循环调用API：

```python
import requests
import pandas as pd

# 读取数据
df = pd.read_csv('data_to_predict.csv')

# 批量预测
results = []
for _, row in df.iterrows():
    data = row.to_dict()
    response = requests.post('http://localhost:8000/predict_live', json=data)
    if response.status_code == 200:
        result = response.json()
        results.append(result['prediction'])
    else:
        results.append('Error')

# 保存结果
df['prediction'] = results
df.to_csv('predictions.csv', index=False)
```

## 常见问题

### Q: 预测返回500错误？
A: 确保已经训练过模型，`final_models/model.pkl` 文件存在。

### Q: 如何提高预测准确率？
A: 使用更多高质量的训练数据重新训练模型。

### Q: 可以预测其他类型的威胁吗？
A: 当前模型专注于网络钓鱼检测，其他威胁类型需要重新训练。

## 下一步

- [模型训练教程](模型训练)
- [API使用文档](API文档)
